<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicateurs Faibles - GEOPOL</title>

    <!-- Styles de base.html -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåç</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Styles de base.html - MISSION CONTROL */
        .mission-header {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            height: 140px;
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid #f59e0b;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        @keyframes radar-sweep {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .radar-effect::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200%;
            height: 200%;
            background: conic-gradient( transparent 0deg, rgba(34, 197, 94, 0.1) 30deg, transparent 60deg, rgba(59, 130, 246, 0.1) 120deg, transparent 150deg, rgba(245, 158, 11, 0.1) 210deg, transparent 240deg, rgba(239, 68, 68, 0.1) 300deg, transparent 330deg );
            animation: radar-sweep 8s linear infinite;
            transform-origin: 0 0;
        }

        .mission-title {
            font-family: 'Segoe UI', system-ui, sans-serif;
            font-weight: 800;
            color: #f59e0b;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3), 0 0 20px rgba(245, 158, 11, 0.4), 0 0 30px rgba(245, 158, 11, 0.2);
            letter-spacing: -0.5px;
            position: relative;
        }

        .mission-subtitle {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #cbd5e1;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .status-badge {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .status-online {
            border-left: 3px solid #10b981;
        }

        .status-dev {
            border-left: 3px solid #f59e0b;
        }

        .data-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            .data-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #f59e0b, #84cc16, #06b6d4);
            }

            .data-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }

        @keyframes pulse-glow {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .pulse-indicator {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .badge-economy {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            font-size: 0.6rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            animation: pulse-glow 1.5s ease-in-out infinite;
        }

        .badge-new {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            font-size: 0.6rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .tech-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .tech-roberta {
            background: #ef4444;
        }

        .tech-spacy {
            background: #3b82f6;
        }

        .tech-mistral {
            background: #8b5cf6;
        }

        /* Styles sp√©cifiques aux indicateurs faibles */
        .indicator-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        }

        .indicator-header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            border-top-left-radius: 11px;
            border-top-right-radius: 11px;
        }

        .risk-badge-1 {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .risk-badge-2 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .risk-badge-3 {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
        }

        .risk-badge-4 {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .sdr-anomaly {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid #ef4444;
            animation: pulse-glow 1s ease-in-out infinite;
        }

        .financial-positive {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }

        .financial-negative {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
        }

        /* Scrollbar personnalis√©e */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #f59e0b 0%, #84cc16 100%);
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(135deg, #d97706 0%, #65a30d 100%);
            }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* Styles pour les filtres */
        .filter-chip {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.875rem;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s;
        }

            .filter-chip:hover {
                background: #f1f5f9;
                border-color: #cbd5e1;
                transform: translateY(-1px);
            }

            .filter-chip.active {
                background: linear-gradient(135deg, #3b82f6, #2563eb);
                color: white;
                border-color: #3b82f6;
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            }

        .active-filter-tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border-radius: 16px;
            font-size: 0.75rem;
            margin: 2px;
        }

            .active-filter-tag button {
                margin-left: 6px;
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                opacity: 0.8;
            }

                .active-filter-tag button:hover {
                    opacity: 1;
                }

        /* Animation pour le panneau filtres */
        @keyframes slideDown {
            from {
                max-height: 0;
                opacity: 0;
            }

            to {
                max-height: 500px;
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                max-height: 500px;
                opacity: 1;
            }

            to {
                max-height: 0;
                opacity: 0;
            }
        }

        .slide-down {
            animation: slideDown 0.3s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }

        /* Styles pour les alertes */
        .alert-badge {
            position: relative;
            display: inline-block;
        }

        .alert-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .alert-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            min-width: 300px;
            max-width: 400px;
            background: white;
            border-left: 4px solid;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-toast.critical {
            border-left-color: #ef4444;
        }

        .alert-toast.warning {
            border-left-color: #f59e0b;
        }

        .alert-toast.info {
            border-left-color: #3b82f6;
        }

        .alert-card {
            border-left: 4px solid;
            transition: all 0.2s;
        }

            .alert-card.critical {
                border-left-color: #ef4444;
                background: linear-gradient(135deg, #fef2f2, #fee2e2);
            }

            .alert-card.warning {
                border-left-color: #f59e0b;
                background: linear-gradient(135deg, #fffbeb, #fef3c7);
            }

            .alert-card.info {
                border-left-color: #3b82f6;
                background: linear-gradient(135deg, #eff6ff, #dbeafe);
            }

            .alert-card:hover {
                transform: translateX(2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

        .severity-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-critical {
            background: #ef4444;
            color: white;
        }

        .severity-warning {
            background: #f59e0b;
            color: white;
        }

        .severity-info {
            background: #3b82f6;
            color: white;
        }

        .alert-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #64748b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

            .alert-tab:hover {
                color: #334155;
                border-bottom-color: #cbd5e1;
            }

            .alert-tab.active {
                color: #3b82f6;
                border-bottom-color: #3b82f6;
            }

        .alert-tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

            .alert-tab-content.active {
                display: block;
            }

        .rule-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

            .rule-card:hover {
                border-color: #cbd5e1;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }

            .rule-card.enabled {
                border-left: 4px solid #10b981;
            }

            .rule-card.disabled {
                border-left: 4px solid #94a3b8;
                opacity: 0.7;
            }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
        }

            .toggle-switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 24px;
        }

            .toggle-slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }

        input:checked + .toggle-slider {
            background-color: #10b981;
        }

            input:checked + .toggle-slider:before {
                transform: translateX(26px);
            }

    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100">

    <!-- EN-T√äTE MISSION CONTROL -->
    <header class="mission-header radar-effect">
        <div class="container mx-auto px-6 h-full flex items-center justify-between">
            <!-- Logo et identit√© -->
            <div class="flex items-center space-x-6">
                <div class="relative group">
                    <div class="h-16 w-16 flex items-center justify-center bg-gradient-to-br from-yellow-500 to-amber-600 rounded-xl shadow-2xl">
                        <i class="fas fa-satellite-dish text-white text-3xl"></i>
                    </div>
                    <div class="absolute -inset-2 bg-yellow-500/20 rounded-full blur-md group-hover:blur-lg transition-all duration-300 -z-10"></div>
                </div>

                <div class="flex flex-col">
                    <h1 class="mission-title text-3xl">INDICATEURS FAIBLES</h1>
                    <p class="mission-subtitle text-sm mt-1">
                        <i class="fas fa-chart-network mr-2 pulse-indicator"></i>
                        Surveillance G√©opolitique en Temps R√©el
                    </p>
                </div>
            </div>

            <!-- Statuts et informations -->
            <div class="flex flex-col space-y-2 items-end">
                <div class="flex space-x-3">
                    <div class="status-badge status-online flex items-center space-x-2">
                        <i class="fas fa-circle text-green-500 text-xs"></i>
                        <span>En ligne</span>
                    </div>
                    <div class="status-badge status-dev flex items-center space-x-2">
                        <i class="fas fa-database text-blue-500 text-xs"></i>
                        <span>Persistance SQLite</span>
                    </div>
                </div>

                <div class="text-slate-300 text-xs font-mono">
                    <div class="flex items-center space-x-2 mb-1">
                        <span class="tech-indicator tech-roberta"></span>
                        <span class="tech-indicator tech-spacy"></span>
                        <span class="tech-indicator tech-mistral"></span>
                        <span>Finance ‚Ä¢ Voyage ‚Ä¢ SDR</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-globe-europe text-cyan-400"></i>
                        <span style="color:#ff72d2 !important;">GEOPOL Analytics</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- BARRE D'OUTILS -->
    <nav class="bg-gradient-to-r from-slate-800 to-slate-900 border-b border-slate-700 shadow-lg">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center py-3">
                <div>
                    <div class="flex items-center space-x-4 text-slate-300 text-sm">
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-plane-departure text-blue-400"></i>
                            <span>Avis Voyageurs</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-chart-line text-green-400"></i>
                            <span>March√©s Financiers</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-broadcast-tower text-purple-400"></i>
                            <span>Surveillance SDR</span>
                        </div>
                        <div class="flex items-center space-x-1 bg-blue-900/50 px-2 py-1 rounded">
                            <i class="fas fa-database text-blue-400"></i>
                            <span class="text-blue-300">Persistance</span>
                            <span class="badge-economy">ACTIVE</span>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <span id="currentTime" class="text-slate-300 font-mono text-sm"></span>

                    <!-- Badge alerte -->
                    <div class="alert-badge">
                        <button id="alertsBell" class="text-slate-300 hover:text-yellow-400 transition-colors">
                            <i class="fas fa-bell text-xl"></i>
                        </button>
                        <span id="alertCount" class="alert-count hidden">0</span>
                    </div>

                    <div class="w-2 h-2 bg-green-500 rounded-full pulse-indicator"></div>
                </div>

            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 fade-in">
            <div class="data-card">
                <div class="p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-700">Avis Voyageurs</h3>
                            <p class="text-3xl font-bold text-blue-600" id="travel-count">0</p>
                            <p class="text-xs text-slate-500 mt-1" id="travel-source">Chargement...</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-4 rounded-full">
                            <i class="fas fa-plane-departure text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-card">
                <div class="p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-700">Instruments Financiers</h3>
                            <p class="text-3xl font-bold text-green-600" id="financial-count">0</p>
                            <p class="text-xs text-slate-500 mt-1" id="financial-source">Chargement...</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-100 to-green-200 p-4 rounded-full">
                            <i class="fas fa-chart-line text-green-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-card">
                <div class="p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-700">Fr√©quences SDR</h3>
                            <p class="text-3xl font-bold text-purple-600" id="sdr-count">0</p>
                            <p class="text-xs text-slate-500 mt-1" id="sdr-source">Chargement...</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-4 rounded-full">
                            <i class="fas fa-broadcast-tower text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-card">
                <div class="p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-700">Persistance DB</h3>
                            <p class="text-3xl font-bold text-amber-600" id="db-total">0</p>
                            <p class="text-xs text-slate-500 mt-1">Donn√©es stock√©es</p>
                        </div>
                        <div class="bg-gradient-to-br from-amber-100 to-amber-200 p-4 rounded-full">
                            <i class="fas fa-database text-amber-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Filtres Interactifs -->
        <div class="indicator-card mb-6 fade-in">
            <div class="indicator-header p-6">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <i class="fas fa-sliders-h text-cyan-400 mr-3"></i>
                    Filtres Interactifs
                    <span class="badge-new ml-2">Dashboard</span>
                </h2>
                <p class="text-slate-300 text-sm mt-1">Personnalisez l'affichage selon vos besoins d'analyse</p>
            </div>

            <div class="p-6">
                <!-- Barre de contr√¥le principale -->
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <!-- Recherche globale -->
                    <div class="flex-1">
                        <div class="relative">
                            <input type="text"
                                   id="globalSearch"
                                   placeholder="Rechercher pays, indicateur, fr√©quence..."
                                   class="w-full px-4 py-3 pl-12 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <i class="fas fa-search absolute left-4 top-3.5 text-slate-400"></i>
                        </div>
                    </div>

                    <!-- S√©lecteur de cat√©gorie -->
                    <div class="w-full md:w-64">
                        <select id="categoryFilter" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">Toutes cat√©gories</option>
                            <option value="travel">Avis de Voyage</option>
                            <option value="financial">March√©s Financiers</option>
                            <option value="sdr">Surveillance SDR</option>
                        </select>
                    </div>

                    <!-- Bouton filtres avanc√©s -->
                    <div>
                        <button id="toggleAdvancedFilters"
                                class="px-6 py-3 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white rounded-lg transition-all duration-300 flex items-center">
                            <i class="fas fa-filter mr-2"></i>
                            Filtres Avanc√©s
                            <i id="filterArrow" class="fas fa-chevron-down ml-2 transition-transform"></i>
                        </button>
                    </div>
                </div>

                <!-- Panneau filtres avanc√©s (cach√© par d√©faut) -->
                <div id="advancedFiltersPanel" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-6 bg-slate-50 border border-slate-200 rounded-xl">

                        <!-- Filtres Voyage -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-slate-700 flex items-center">
                                <i class="fas fa-plane-departure text-blue-500 mr-2"></i>
                                Avis de Voyage
                            </h4>

                            <div>
                                <label class="block text-sm text-slate-600 mb-2">Niveau de risque</label>
                                <div class="flex flex-wrap gap-2">
                                    <button class="filter-chip risk-filter" data-risk="1">
                                        <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                        Niveau 1
                                    </button>
                                    <button class="filter-chip risk-filter" data-risk="2">
                                        <span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>
                                        Niveau 2
                                    </button>
                                    <button class="filter-chip risk-filter" data-risk="3">
                                        <span class="w-3 h-3 rounded-full bg-orange-500 mr-2"></span>
                                        Niveau 3
                                    </button>
                                    <button class="filter-chip risk-filter" data-risk="4">
                                        <span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span>
                                        Niveau 4
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-slate-600 mb-2">Source</label>
                                <select id="sourceFilter" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                                    <option value="all">Toutes sources</option>
                                    <option value="uk_gov">UK Government</option>
                                    <option value="fr_diplomatie">France Diplomatie</option>
                                    <option value="au_smartraveller">Australia Smartraveller</option>
                                </select>
                            </div>
                        </div>

                        <!-- Filtres Financiers -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-slate-700 flex items-center">
                                <i class="fas fa-chart-line text-green-500 mr-2"></i>
                                March√©s Financiers
                            </h4>

                            <div>
                                <label class="block text-sm text-slate-600 mb-2">Cat√©gorie</label>
                                <div class="flex flex-wrap gap-2">
                                    <button class="filter-chip category-filter" data-category="index">
                                        <i class="fas fa-chart-bar mr-2"></i>
                                        Indices
                                    </button>
                                    <button class="filter-chip category-filter" data-category="commodity">
                                        <i class="fas fa-gas-pump mr-2"></i>
                                        Commodities
                                    </button>
                                    <button class="filter-chip category-filter" data-category="crypto">
                                        <i class="fab fa-bitcoin mr-2"></i>
                                        Crypto
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-slate-600 mb-2">Variation</label>
                                <div class="flex items-center space-x-4">
                                    <input type="number" id="minChange" placeholder="Min %"
                                           class="w-24 px-3 py-2 border border-slate-300 rounded-lg">
                                    <span class="text-slate-400">√†</span>
                                    <input type="number" id="maxChange" placeholder="Max %"
                                           class="w-24 px-3 py-2 border border-slate-300 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <!-- Filtres SDR -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-slate-700 flex items-center">
                                <i class="fas fa-broadcast-tower text-purple-500 mr-2"></i>
                                Surveillance SDR
                            </h4>

                            <div>
                                <label class="block text-sm text-slate-600 mb-2">Type d'activit√©</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="anomalyOnly" class="mr-2 rounded">
                                        <span class="text-sm">Anomalies seulement</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="highActivity" class="mr-2 rounded">
                                        <span class="text-sm">Haute activit√© (>75%)</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-slate-600 mb-2">Plage de fr√©quences (kHz)</label>
                                <div class="flex items-center space-x-4">
                                    <input type="number" id="minFreq" placeholder="Min"
                                           class="w-24 px-3 py-2 border border-slate-300 rounded-lg" value="0">
                                    <span class="text-slate-400">√†</span>
                                    <input type="number" id="maxFreq" placeholder="Max"
                                           class="w-24 px-3 py-2 border border-slate-300 rounded-lg" value="30000">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Barre d'actions filtres -->
                    <div class="flex justify-between items-center mt-6 pt-6 border-t border-slate-200">
                        <div class="text-sm text-slate-600" id="activeFiltersCount">
                            Aucun filtre actif
                        </div>
                        <div class="flex space-x-3">
                            <button id="applyFilters"
                                    class="px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all duration-300">
                                <i class="fas fa-check mr-2"></i>
                                Appliquer les filtres
                            </button>
                            <button id="resetFilters"
                                    class="px-6 py-2 bg-gradient-to-r from-slate-400 to-slate-500 hover:from-slate-500 hover:to-slate-600 text-white rounded-lg transition-all duration-300">
                                <i class="fas fa-redo mr-2"></i>
                                R√©initialiser
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Barre filtres actifs -->
                <div id="activeFiltersBar" class="hidden mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex justify-between items-center">
                        <div class="flex flex-wrap gap-2" id="activeFiltersList">
                            <!-- Les filtres actifs appara√Ætront ici -->
                        </div>
                        <button onclick="clearAllFilters()" class="text-sm text-blue-600 hover:text-blue-800">
                            <i class="fas fa-times mr-1"></i>
                            Tout effacer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Alertes Personnalis√©es - VERSION CORRIG√âE -->
        <div class="indicator-card mb-6 fade-in" id="alerts-section">
            <div class="indicator-header p-6">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <i class="fas fa-bell text-amber-400 mr-3"></i>
                    Alertes Personnalis√©es
                    <span class="badge-new ml-2">Beta</span>
                </h2>
                <p class="text-slate-300 text-sm mt-1">
                    Surveillance automatique selon vos crit√®res g√©opolitiques
                </p>
            </div>

            <div class="p-6">
                <!-- Statistiques rapides -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-red-50 to-red-100 border border-red-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-red-600" id="alert-critical-count">0</div>
                        <div class="text-sm font-medium text-red-800">Critiques</div>
                    </div>
                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-amber-600" id="alert-warning-count">0</div>
                        <div class="text-sm font-medium text-amber-800">Avertissements</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-600" id="alert-info-count">0</div>
                        <div class="text-sm font-medium text-blue-800">Informations</div>
                    </div>
                    <div class="bg-gradient-to-br from-slate-50 to-slate-100 border border-slate-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-slate-600" id="alert-total-count">0</div>
                        <div class="text-sm font-medium text-slate-800">Total</div>
                    </div>
                </div>

                <!-- Onglets -->
                <div class="flex border-b border-slate-200 mb-6">
                    <button class="alert-tab active" data-tab="alerts-list">
                        <i class="fas fa-exclamation-circle mr-2"></i>Alertes Actives
                        <span id="active-alerts-badge" class="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1 hidden">0</span>
                    </button>
                    <button class="alert-tab" data-tab="alert-config">
                        <i class="fas fa-cog mr-2"></i>Configuration
                    </button>
                    <button class="alert-tab" data-tab="alert-rules">
                        <i class="fas fa-list-check mr-2"></i>R√®gles
                        <span id="rules-count" class="ml-2 bg-blue-500 text-white text-xs rounded-full px-2 py-1">0</span>
                    </button>
                    <button class="alert-tab" data-tab="alert-history">
                        <i class="fas fa-history mr-2"></i>Historique
                    </button>
                </div>

                <!-- Contenu des onglets -->
                <!-- 1. Alertes Actives -->
                <div id="alerts-list" class="alert-tab-content active">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold text-slate-700">Alertes non lues</h3>
                        <button id="markAllRead" class="px-4 py-2 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white text-sm rounded-lg transition-all duration-300">
                            <i class="fas fa-check-double mr-2"></i>Tout marquer comme lu
                        </button>
                    </div>

                    <div class="space-y-3" id="active-alerts-container">
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-check-circle text-2xl mb-4"></i>
                            <p>Aucune alerte active</p>
                            <p class="text-sm mt-2">Tout est normal pour le moment</p>
                        </div>
                    </div>
                </div>

                <!-- 2. Configuration -->
                <div id="alert-config" class="alert-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Nouvelle alerte -->
                        <div class="bg-slate-50 border border-slate-200 rounded-xl p-5">
                            <h3 class="font-semibold text-slate-700 mb-4 flex items-center">
                                <i class="fas fa-plus-circle text-green-500 mr-2"></i>
                                Cr√©er une nouvelle alerte
                            </h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm text-slate-600 mb-2">Nom de l'alerte</label>
                                    <input type="text" id="alert-name"
                                           class="w-full px-3 py-2 border border-slate-300 rounded-lg"
                                           placeholder="Ex: Crash CAC40, Risque France, etc.">
                                </div>

                                <div>
                                    <label class="block text-sm text-slate-600 mb-2">Cat√©gorie</label>
                                    <select id="alert-category" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                                        <option value="financial">March√©s Financiers</option>
                                        <option value="travel">Avis de Voyage</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm text-slate-600 mb-2">S√©v√©rit√©</label>
                                    <div class="flex space-x-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="severity" value="info" class="mr-2">
                                            <span class="severity-badge severity-info px-3">Information</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="severity" value="warning" class="mr-2" checked>
                                            <span class="severity-badge severity-warning px-3">Avertissement</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="severity" value="critical" class="mr-2">
                                            <span class="severity-badge severity-critical px-3">Critique</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm text-slate-600 mb-2">Condition</label>
                                    <div class="space-y-2">
                                        <select id="condition-template" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                                            <option value="">-- S√©lectionner un mod√®le --</option>
                                            <optgroup label="Financier">
                                                <option value="data.change_percent < -7">Crash march√© (&lt; -7%)</option>
                                                <option value="data.change_percent < -5">Baisse significative (&lt; -5%)</option>
                                                <option value="abs(data.change_percent) > 3">Haute volatilit√© (&gt; ¬±3%)</option>
                                                <option value="data.change_percent > 5">Forte hausse (&gt; +5%)</option>
                                            </optgroup>
                                            <optgroup label="Voyage">
                                                <option value="data.risk_level == 4">Ne pas voyager (niveau 4)</option>
                                                <option value="data.risk_level == 3">R√©envisager voyage (niveau 3)</option>
                                                <option value="previous and data.risk_level > previous.risk_level">Risque augment√©</option>
                                                <option value="previous and data.risk_level < previous.risk_level">Risque diminu√©</option>
                                            </optgroup>
                                        </select>

                                        <div class="relative">
                                            <input type="text" id="alert-condition"
                                                   class="w-full px-3 py-2 border border-slate-300 rounded-lg font-mono text-sm"
                                                   placeholder="Ex: data.change_percent < -5">
                                            <div class="absolute right-2 top-2">
                                                <button onclick="testCondition()" class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded">
                                                    <i class="fas fa-vial mr-1"></i>Tester
                                                </button>
                                            </div>
                                        </div>

                                        <div class="text-xs text-slate-500">
                                            <p><strong>Variables disponibles:</strong></p>
                                            <p><code>data</code> : donn√©es actuelles</p>
                                            <p><code>previous</code> : donn√©es pr√©c√©dentes (si disponibles)</p>
                                            <p><strong>Exemples:</strong></p>
                                            <p><code>data.change_percent &lt; -5</code> (baisse de 5%)</p>
                                            <p><code>data.risk_level == 4</code> (risque maximum)</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm text-slate-600 mb-2">Message</label>
                                    <input type="text" id="alert-message"
                                           class="w-full px-3 py-2 border border-slate-300 rounded-lg"
                                           placeholder="Ex: {name} chute de {change_percent}%">
                                    <p class="text-xs text-slate-500 mt-1">
                                        Utilisez <code>{variable}</code> pour ins√©rer des donn√©es
                                    </p>
                                </div>

                                <div class="flex justify-between pt-4 border-t border-slate-200">
                                    <button id="save-alert" class="px-6 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg transition-all duration-300">
                                        <i class="fas fa-save mr-2"></i>Cr√©er l'alerte
                                    </button>
                                    <button id="test-alert" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all duration-300">
                                        <i class="fas fa-vial mr-2"></i>Tester avec donn√©es actuelles
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Alertes pr√©d√©finies -->
                        <div class="bg-slate-50 border border-slate-200 rounded-xl p-5">
                            <h3 class="font-semibold text-slate-700 mb-4 flex items-center">
                                <i class="fas fa-magic text-purple-500 mr-2"></i>
                                Mod√®les Pr√©d√©finis
                            </h3>

                            <div class="space-y-3">
                                <!-- Mod√®les Financiers -->
                                <div>
                                    <h4 class="font-medium text-slate-700 mb-2 flex items-center">
                                        <i class="fas fa-chart-line text-green-500 mr-2"></i>
                                        March√©s Financiers
                                    </h4>
                                    <div class="space-y-2">
                                        <button class="w-full text-left p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors"
                                                onclick="loadTemplate('market_crash', 'Crash boursier', 'financial', 'critical', 'data.change_percent < -7', 'CRASH: {name} chute de {change_percent}%')">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <div class="font-medium">Crash boursier</div>
                                                    <div class="text-sm text-slate-500">Variation &lt; -7%</div>
                                                </div>
                                                <span class="severity-badge severity-critical">Critique</span>
                                            </div>
                                        </button>

                                        <button class="w-full text-left p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors"
                                                onclick="loadTemplate('high_vol', 'Haute volatilit√©', 'financial', 'info', 'abs(data.change_percent) > 3', 'Volatilit√©: {name} {change_percent:+.2f}%')">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <div class="font-medium">Haute volatilit√©</div>
                                                    <div class="text-sm text-slate-500">Variation &gt; ¬±3%</div>
                                                </div>
                                                <span class="severity-badge severity-info">Information</span>
                                            </div>
                                        </button>
                                    </div>
                                </div>

                                <!-- Mod√®les Voyage -->
                                <div>
                                    <h4 class="font-medium text-slate-700 mb-2 flex items-center">
                                        <i class="fas fa-plane-departure text-blue-500 mr-2"></i>
                                        Avis de Voyage
                                    </h4>
                                    <div class="space-y-2">
                                        <button class="w-full text-left p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors"
                                                onclick="loadTemplate('no_travel', 'Ne pas voyager', 'travel', 'critical', 'data.risk_level == 4', '‚ö†Ô∏è {country_name}: NIVEAU 4 - Ne pas voyager')">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <div class="font-medium">Ne pas voyager</div>
                                                    <div class="text-sm text-slate-500">Niveau risque 4</div>
                                                </div>
                                                <span class="severity-badge severity-critical">Critique</span>
                                            </div>
                                        </button>

                                        <button class="w-full text-left p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors"
                                                onclick="loadTemplate('risk_up', 'Risque augment√©', 'travel', 'warning', 'previous and data.risk_level > previous.risk_level', 'üìà {country_name}: Risque {previous.risk_level}‚Üí{data.risk_level}')">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <div class="font-medium">Risque augment√©</div>
                                                    <div class="text-sm text-slate-500">D√©tection am√©lioration</div>
                                                </div>
                                                <span class="severity-badge severity-warning">Avertissement</span>
                                            </div>
                                        </button>
                                    </div>
                                </div>

                                <!-- Param√®tres globaux - CORRIG√â -->
                                <div class="pt-4 border-t border-slate-200">
                                    <h4 class="font-medium text-slate-700 mb-3 flex items-center">
                                        <i class="fas fa-sliders-h text-amber-500 mr-2"></i>
                                        Param√®tres globaux
                                    </h4>

                                    <div class="space-y-3">
                                        <!-- Correction : div au lieu de label -->
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="font-medium">Notifications visuelles</div>
                                                <div class="text-sm text-slate-500">Afficher les popups d'alerte</div>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="show-toasts" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>

                                        <!-- M√™me correction ici -->
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="font-medium">Son d'alerte</div>
                                                <div class="text-sm text-slate-500">Jouer un son pour alertes critiques</div>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="play-sound">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>

                                        <div>
                                            <label class="block text-sm text-slate-600 mb-2">Archivage automatique</label>
                                            <select id="archive-days" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                                                <option value="7">7 jours</option>
                                                <option value="30" selected>30 jours</option>
                                                <option value="90">90 jours</option>
                                                <option value="365">1 an</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. R√®gles d'alerte -->
                <div id="alert-rules" class="alert-tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold text-slate-700">R√®gles configur√©es</h3>
                        <div class="text-sm text-slate-500">
                            <span id="enabled-rules-count">0</span> activ√©es / <span id="total-rules-count">0</span> total
                        </div>
                    </div>

                    <div class="space-y-3" id="rules-container">
                        <!-- R√®gles charg√©es dynamiquement -->
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-cogs text-2xl mb-4"></i>
                            <p>Chargement des r√®gles...</p>
                        </div>
                    </div>
                </div>

                <!-- 4. Historique des alertes -->
                <div id="alert-history" class="alert-tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold text-slate-700">Historique des 30 derniers jours</h3>
                        <button onclick="exportAlertHistory()" class="px-4 py-2 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white text-sm rounded-lg transition-all duration-300">
                            <i class="fas fa-file-export mr-2"></i>Exporter l'historique
                        </button>
                    </div>

                    <div class="space-y-3" id="history-container">
                        <!-- Historique charg√© dynamiquement -->
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-history text-2xl mb-4"></i>
                            <p>Chargement de l'historique...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 fade-in">
            <!-- Travel Advisories Section -->
            <div class="indicator-card">
                <div class="indicator-header p-6">
                    <h2 class="text-xl font-semibold text-white flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-400 mr-3"></i>
                        Avis aux Voyageurs
                        <span class="badge-new ml-2">Scraping L√©ger</span>
                    </h2>
                    <p class="text-slate-300 text-sm mt-1">Sources: UK Gov ‚Ä¢ Australia ‚Ä¢ France Diplomatie</p>
                </div>
                <div class="p-6" id="travel-container">
                    <div class="text-center py-8 text-slate-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-4"></i>
                        <p>Chargement des avis...</p>
                    </div>
                </div>
            </div>

            <!-- Financial Markets Section -->
            <div class="indicator-card">
                <div class="indicator-header p-6">
                    <h2 class="text-xl font-semibold text-white flex items-center">
                        <i class="fas fa-chart-bar text-green-400 mr-3"></i>
                        March√©s Financiers
                        <span class="badge-economy ml-2">Temps R√©el</span>
                    </h2>
                    <p class="text-slate-300 text-sm mt-1">Indices ‚Ä¢ Commodities ‚Ä¢ Cryptos</p>
                </div>
                <div class="p-6">
                    <canvas id="financial-chart" height="300"></canvas>
                </div>
            </div>

            <!-- SDR Activity Section -->
            <div class="indicator-card lg:col-span-2">
                <div class="indicator-header p-6">
                    <h2 class="text-xl font-semibold text-white flex items-center">
                        <i class="fas fa-wave-square text-purple-400 mr-3"></i>
                        Activit√© SDR - Surveillance Spectrale
                        <span class="badge-new ml-2">RTL-SDR</span>
                    </h2>
                    <p class="text-slate-300 text-sm mt-1">Fr√©quences strat√©giques et anomalies</p>
                </div>
                <div class="p-6" id="sdr-container">
                    <div class="text-center py-8 text-slate-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-4"></i>
                        <p>Chargement de l'activit√© SDR...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Statistiques de Persistance -->
        <div class="indicator-card mb-8 fade-in">
            <div class="indicator-header p-6">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <i class="fas fa-database text-cyan-400 mr-3"></i>
                    Statistiques de Persistance
                    <span class="badge-economy ml-2">SQLite</span>
                </h2>
                <p class="text-slate-300 text-sm mt-1">Base de donn√©es locale - Pas d'enregistrement requis</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold text-blue-600" id="db-travel-count">0</div>
                        <div class="text-sm font-medium text-blue-800 mt-2">Avis en Base</div>
                        <div class="text-xs text-blue-600 mt-1">Expire dans 24h</div>
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold text-green-600" id="db-financial-count">0</div>
                        <div class="text-sm font-medium text-green-800 mt-2">Instruments en Base</div>
                        <div class="text-xs text-green-600 mt-1">Expire dans 5min</div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold text-purple-600" id="db-sdr-count">0</div>
                        <div class="text-sm font-medium text-purple-800 mt-2">Activit√©s SDR en Base</div>
                        <div class="text-xs text-purple-600 mt-1">Conserv√© 30 jours</div>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 justify-center">
                    <button onclick="loadStats()" class="bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-800 hover:to-slate-900 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 flex items-center shadow-lg hover:shadow-xl">
                        <i class="fas fa-chart-bar mr-3"></i>
                        Voir les Statistiques D√©taill√©es
                    </button>
                    <button onclick="forceUpdate()" class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 flex items-center shadow-lg hover:shadow-xl">
                        <i class="fas fa-sync-alt mr-3"></i>
                        Forcer Mise √† Jour
                    </button>
                    <button onclick="clearCache()" class="bg-gradient-to-r from-rose-500 to-rose-600 hover:from-rose-600 hover:to-rose-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 flex items-center shadow-lg hover:shadow-xl">
                        <i class="fas fa-trash-alt mr-3"></i>
                        Nettoyer le Cache
                    </button>
                </div>
            </div>
        </div>

        <!-- Section Export de Donn√©es -->
        <div class="indicator-card mb-8 fade-in">
            <div class="indicator-header p-6">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <i class="fas fa-file-export text-emerald-400 mr-3"></i>
                    Export de Donn√©es
                    <span class="badge-economy ml-2">CSV/JSON</span>
                </h2>
                <p class="text-slate-300 text-sm mt-1">T√©l√©chargez les donn√©es pour analyse hors ligne</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- Carte Export Voyage -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-5 text-center hover:shadow-lg transition-all duration-300">
                        <div class="text-blue-600 text-3xl mb-3">
                            <i class="fas fa-plane-departure"></i>
                        </div>
                        <h3 class="font-bold text-blue-800 mb-2">Avis de Voyage</h3>
                        <p class="text-sm text-blue-600 mb-4">Donn√©es g√©opolitiques et conseils</p>
                        <button onclick="exportData('travel')" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fas fa-download mr-2"></i>
                            Exporter CSV
                        </button>
                    </div>

                    <!-- Carte Export Financier -->
                    <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-5 text-center hover:shadow-lg transition-all duration-300">
                        <div class="text-green-600 text-3xl mb-3">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="font-bold text-green-800 mb-2">March√©s Financiers</h3>
                        <p class="text-sm text-green-600 mb-4">Indices, commodities, cryptos</p>
                        <button onclick="exportData('financial')" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fas fa-download mr-2"></i>
                            Exporter CSV
                        </button>
                    </div>

                    <!-- Carte Export SDR -->
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-5 text-center hover:shadow-lg transition-all duration-300">
                        <div class="text-purple-600 text-3xl mb-3">
                            <i class="fas fa-broadcast-tower"></i>
                        </div>
                        <h3 class="font-bold text-purple-800 mb-2">Surveillance SDR</h3>
                        <p class="text-sm text-purple-600 mb-4">Fr√©quences et anomalies</p>
                        <button onclick="exportData('sdr')" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fas fa-download mr-2"></i>
                            Exporter CSV
                        </button>
                    </div>

                    <!-- Carte Export Complet -->
                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 rounded-xl p-5 text-center hover:shadow-lg transition-all duration-300">
                        <div class="text-amber-600 text-3xl mb-3">
                            <i class="fas fa-database"></i>
                        </div>
                        <h3 class="font-bold text-amber-800 mb-2">Export Complet</h3>
                        <p class="text-sm text-amber-600 mb-4">Toutes les donn√©es (JSON)</p>
                        <button onclick="exportData('all')" class="w-full bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fas fa-file-archive mr-2"></i>
                            Exporter JSON
                        </button>
                    </div>
                </div>

                <!-- Options avanc√©es -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                    <h4 class="font-semibold text-slate-700 mb-3 flex items-center">
                        <i class="fas fa-cog text-slate-500 mr-2"></i>
                        Options d'export
                    </h4>
                    <div class="flex flex-wrap gap-4">
                        <div>
                            <label class="block text-sm text-slate-600 mb-1">P√©riode</label>
                            <select id="exportPeriod" class="px-3 py-2 border border-slate-300 rounded-lg bg-white">
                                <option value="recent">7 derniers jours</option>
                                <option value="month">30 derniers jours</option>
                                <option value="all">Toutes les donn√©es</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-600 mb-1">Format</label>
                            <select id="exportFormat" class="px-3 py-2 border border-slate-300 rounded-lg bg-white">
                                <option value="csv">CSV (Excel)</option>
                                <option value="json">JSON (API)</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="exportWithOptions()" class="bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fas fa-file-export mr-2"></i>
                                Exporter avec options
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2 flex items-center">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                        Instructions d'utilisation
                    </h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>‚Ä¢ <strong>CSV</strong> : Ouverture recommand√©e avec Excel ou LibreOffice Calc</li>
                        <li>‚Ä¢ <strong>JSON</strong> : Format structur√© pour analyse programmatique</li>
                        <li>‚Ä¢ Les donn√©es sont encod√©es en <strong>UTF-8</strong> (caract√®res fran√ßais support√©s)</li>
                        <li>‚Ä¢ Les fichiers incluent automatiquement la date d'export dans le nom</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="text-center">
            <button id="refresh-btn" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 flex items-center mx-auto shadow-2xl hover:shadow-3xl transform hover:-translate-y-1">
                <i class="fas fa-sync-alt mr-3"></i>
                <span class="text-lg">Mettre √† Jour Toutes les Donn√©es</span>
            </button>
            <p class="text-slate-500 text-sm mt-4">
                <i class="fas fa-info-circle mr-2"></i>
                Syst√®me autonome avec scraping l√©ger - Id√©al pour usage scolaire
            </p>
        </div>
    </div>

    <script>
        // ============================================================================
        // FONCTIONS GLOBALES (expos√©es)
        // ============================================================================

        window.clearCache = async function () {
            if (confirm('‚ö†Ô∏è Voulez-vous vraiment nettoyer le cache ?')) {
                try {
                    const response = await fetch('/weak-indicators/api/clear-cache', {
                        method: 'POST'
                    });
                    const data = await response.json();

                    if (data.success) {
                        alert('‚úÖ Cache nettoy√© avec succ√®s');
                        if (window.dashboard) {
                            await window.dashboard.loadDashboardData();
                            await window.dashboard.loadDatabaseStats();
                        }
                    }
                } catch (error) {
                    console.error('Erreur nettoyage cache:', error);
                    alert('‚ùå Erreur lors du nettoyage du cache');
                }
            }
        };

        window.forceUpdate = async function () {
            try {
                const response = await fetch('/weak-indicators/api/force-update', {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Mise √† jour forc√©e effectu√©e');
                    if (window.dashboard) {
                        await window.dashboard.loadDashboardData();
                        await window.dashboard.loadDatabaseStats();
                    }
                }
            } catch (error) {
                console.error('Erreur force update:', error);
                alert('‚ùå Erreur lors de la mise √† jour');
            }
        };

        window.loadStats = function () {
            if (window.dashboard) {
                window.dashboard.loadDatabaseStats();
                alert('üìä Statistiques recharg√©es');
            } else {
                alert('‚ùå Dashboard non initialis√©');
            }
        };

        window.exportData = function (dataType) {
            if (window.dashboard && typeof window.dashboard.exportData === 'function') {
                window.dashboard.exportData(dataType);
            } else {
                console.error('‚ùå Dashboard non initialis√©');
                alert('Syst√®me non initialis√©. Rafra√Æchissez la page.');
            }
        };

        window.exportWithOptions = function () {
            if (window.dashboard && typeof window.dashboard.exportData === 'function') {
                window.dashboard.exportData('all');
            } else {
                alert('Syst√®me non initialis√©');
            }
        };

        window.clearAllFilters = function () {
            if (window.dashboard && window.dashboard.resetFilters) {
                window.dashboard.resetFilters();
            }
        };

        window.testCondition = function () {
            if (window.alertSystem && window.alertSystem.testCondition) {
                window.alertSystem.testCondition();
            } else {
                alert('Syst√®me d\'alertes non initialis√©');
            }
        };

        window.exportAlertHistory = function () {
            if (window.alertSystem && window.alertSystem.exportAlertHistory) {
                window.alertSystem.exportAlertHistory();
            }
        };

        // Fonction helper pour charger les templates
        window.loadTemplate = function (id, name, category, severity, condition, message) {
            if (window.alertSystem && window.alertSystem.loadTemplate) {
                window.alertSystem.loadTemplate(id, name, category, severity, condition, message);
            }
        };

        // ============================================================================
        // CLASSES PRINCIPALES
        // ============================================================================

        class WeakIndicatorsDashboard {
            constructor() {
                this.financialChart = null;
                this.currentFilters = {
                    travel: {},
                    financial: {},
                    sdr: {},
                    global: {}
                };
                this.activeFilters = [];
                this.availableFilters = null;
            }

            async init() {
                console.log('üöÄ Initialisation Dashboard...');

                // Mettre √† jour l'heure
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);

                // Charger les donn√©es
                try {
                    await Promise.all([
                        this.loadDashboardData(),
                        this.loadDatabaseStats(),
                        this.loadAvailableFilters()
                    ]);

                    this.setupEventListeners();
                    this.setupFilterEventListeners();

                    console.log('‚úÖ Dashboard initialis√©');
                } catch (error) {
                    console.error('‚ùå Erreur initialisation:', error);
                }
            }

            updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const dateString = now.toLocaleDateString('fr-FR', {
                    weekday: 'short',
                    day: '2-digit',
                    month: 'short'
                });

                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = `${dateString} ‚Ä¢ ${timeString}`;
                }
            }

            async loadDashboardData() {
                try {
                    const response = await fetch('/weak-indicators/api/dashboard');
                    const result = await response.json();

                    if (result.success) {
                        this.updateStats(result.data);
                        this.renderTravelAdvisories(result.data.travel);
                        this.renderFinancialChart(result.data.financial);
                        this.renderSDRActivity(result.data.sdr);
                    } else {
                        console.error('Erreur:', result.error);
                    }
                } catch (error) {
                    console.error('Erreur r√©seau:', error);
                }
            }

            async loadDatabaseStats() {
                try {
                    const response = await fetch('/weak-indicators/api/stats');
                    const result = await response.json();

                    if (result.success && result.stats) {
                        document.getElementById('db-travel-count').textContent = result.stats.travel || 0;
                        document.getElementById('db-financial-count').textContent = result.stats.financial || 0;
                        document.getElementById('db-sdr-count').textContent = result.stats.sdr || 0;
                        const total = (result.stats.travel || 0) + (result.stats.financial || 0) + (result.stats.sdr || 0);
                        document.getElementById('db-total').textContent = total;
                    }
                } catch (error) {
                    console.error('Erreur stats DB:', error);
                }
            }

            async loadAvailableFilters() {
                try {
                    const response = await fetch('/weak-indicators/api/available-filters');
                    const result = await response.json();

                    if (result.success) {
                        this.availableFilters = result.filters;
                        this.populateFilterOptions();
                    }
                } catch (error) {
                    console.error('Erreur chargement filtres:', error);
                }
            }

            populateFilterOptions() {
                if (this.availableFilters?.travel?.sources) {
                    const sourceSelect = document.getElementById('sourceFilter');
                    if (sourceSelect) {
                        sourceSelect.innerHTML = '<option value="all">Toutes sources</option>';
                        this.availableFilters.travel.sources.forEach(source => {
                            const option = document.createElement('option');
                            option.value = source;
                            option.textContent = this.formatSourceName(source);
                            sourceSelect.appendChild(option);
                        });
                    }
                }
            }

            formatSourceName(source) {
                const names = {
                    'uk_gov': 'UK Government',
                    'fr_diplomatie': 'France Diplomatie',
                    'au_smartraveller': 'Australia Smartraveller',
                    'us_state_dept': 'US State Department',
                    'fallback': 'Donn√©es simul√©es'
                };
                return names[source] || source;
            }

            updateStats(data) {
                document.getElementById('travel-count').textContent = data.travel?.length || 0;
                document.getElementById('financial-count').textContent = data.financial?.length || 0;
                document.getElementById('sdr-count').textContent = data.sdr?.length || 0;

                if (data.travel?.length > 0) {
                    const sources = [...new Set(data.travel.map(t => t.source))];
                    document.getElementById('travel-source').textContent = `Sources: ${sources.join(', ')}`;
                }
                if (data.financial?.length > 0) {
                    document.getElementById('financial-source').textContent = 'Source: yfinance';
                }
                if (data.sdr?.length > 0) {
                    document.getElementById('sdr-source').textContent = 'Source: Simulation RTL-SDR';
                }
            }

            renderTravelAdvisories(advisories) {
                const container = document.getElementById('travel-container');
                if (!container) return;

                if (!advisories || advisories.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-info-circle text-2xl mb-4"></i>
                            <p>Aucun avis de voyage disponible</p>
                            <p class="text-sm mt-2">V√©rifiez la connexion r√©seau</p>
                        </div>
                    `;
                    return;
                }

                let html = '<div class="space-y-4">';
                advisories.sort((a, b) => (b.risk_level || 0) - (a.risk_level || 0));
                advisories.slice(0, 8).forEach(advisory => {
                    const riskLevel = advisory.risk_level || 1;
                    const riskClass = `risk-badge-${riskLevel}`;
                    const riskText = ['', 'Pr√©cautions normales', 'Prudence accrue', 'R√©envisager le voyage', 'Ne pas voyager'][riskLevel] || 'Inconnu';

                    html += `
                        <div class="flex items-center justify-between p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="font-semibold text-slate-800">${advisory.country_name || 'Pays inconnu'}</div>
                                    <span class="px-3 py-1 rounded-full text-xs font-bold ml-3 ${riskClass}">
                                        ${riskText}
                                    </span>
                                </div>
                                <div class="text-sm text-slate-600 mb-2">${advisory.summary || 'Aucun r√©sum√© disponible'}</div>
                                <div class="flex items-center text-xs text-slate-500">
                                    <i class="fas fa-database mr-1"></i>
                                    <span>Source: ${advisory.source || 'inconnue'}</span>
                                    <span class="mx-2">‚Ä¢</span>
                                    <i class="far fa-clock mr-1"></i>
                                    <span>${advisory.last_updated ? new Date(advisory.last_updated).toLocaleDateString('fr-FR') : 'Date inconnue'}</span>
                                </div>
                            </div>
                            <div class="text-right ml-4">
                                <div class="text-2xl font-bold text-slate-700">Niv. ${riskLevel}</div>
                                <div class="text-xs text-slate-500 mt-1">Risque</div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                container.innerHTML = html;
            }

            renderFinancialChart(financialData) {
                const ctx = document.getElementById('financial-chart');
                if (!ctx) return;

                if (this.financialChart) {
                    this.financialChart.destroy();
                }

                if (!financialData || financialData.length === 0) {
                    ctx.parentElement.innerHTML = `
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-info-circle text-2xl mb-4"></i>
                            <p>Aucune donn√©e financi√®re disponible</p>
                        </div>
                    `;
                    return;
                }

                const indices = financialData.filter(item => item.category === 'index');
                const commodities = financialData.filter(item => item.category === 'commodity');
                const crypto = financialData.filter(item => item.category === 'crypto');

                const allData = [...indices, ...commodities, ...crypto];
                const labels = allData.map(item =>
                    (item.name || item.symbol || '').length > 15 ?
                        (item.name || item.symbol || '').substring(0, 12) + '...' :
                        (item.name || item.symbol || '')
                );
                const changes = allData.map(item => item.change_percent || 0);

                this.financialChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Variation (%)',
                            data: changes,
                            backgroundColor: changes.map(change =>
                                change >= 0 ? 'rgba(34, 197, 94, 0.7)' : 'rgba(239, 68, 68, 0.7)'
                            ),
                            borderColor: changes.map(change =>
                                change >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'
                            ),
                            borderWidth: 1,
                            borderRadius: 6,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                titleColor: '#f59e0b',
                                bodyColor: '#e2e8f0',
                                borderColor: '#475569',
                                borderWidth: 1,
                                callbacks: {
                                    label: function (context) {
                                        const value = context.parsed.y;
                                        const color = value >= 0 ? 'üü¢' : 'üî¥';
                                        return `${color} Variation: ${value.toFixed(2)}%`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(226, 232, 240, 0.5)' },
                                ticks: {
                                    callback: function (value) { return value + '%'; },
                                    color: '#64748b'
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#64748b' }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }

            renderSDRActivity(activities) {
                const container = document.getElementById('sdr-container');
                if (!container) return;

                if (!activities || activities.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-info-circle text-2xl mb-4"></i>
                            <p>Aucune activit√© SDR disponible</p>
                            <p class="text-sm mt-2">Activation de la simulation</p>
                        </div>
                    `;
                    return;
                }

                let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">';

                activities.forEach(activity => {
                    const isAnomaly = activity.is_anomaly || false;
                    const activityCount = activity.activity_count || 0;
                    const activityLevel = Math.min(100, Math.max(0, activityCount));
                    const intensity = activityLevel > 75 ? 'Haute' : activityLevel > 25 ? 'Moyenne' : 'Basse';

                    html += `
                        <div class="${isAnomaly ? 'sdr-anomaly' : 'bg-white border border-slate-200'} rounded-xl p-4 transition-all duration-300 hover:shadow-lg">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <div class="font-bold text-slate-800">${activity.name || 'Inconnu'}</div>
                                    <div class="font-mono text-sm ${isAnomaly ? 'text-rose-600' : 'text-blue-600'} font-bold">
                                        ${(activity.frequency_khz || 0).toLocaleString()} kHz
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-slate-700">${activityCount}</div>
                                    <div class="text-xs text-slate-500">D√©tections</div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium text-slate-700">Intensit√©</span>
                                    <span class="font-bold ${intensity === 'Haute' ? 'text-rose-600' : intensity === 'Moyenne' ? 'text-amber-600' : 'text-emerald-600'}">
                                        ${intensity}
                                    </span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div class="h-2 rounded-full ${isAnomaly ? 'bg-gradient-to-r from-rose-500 to-rose-600' : 'bg-gradient-to-r from-blue-500 to-blue-600'}"
                                         style="width: ${activityLevel}%"></div>
                                </div>
                            </div>

                            <div class="flex justify-between items-center text-xs">
                                <div class="text-slate-500">
                                    <i class="far fa-clock mr-1"></i>
                                    ${activity.last_seen ? new Date(activity.last_seen).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }) : 'Inconnu'}
                                </div>
                                ${isAnomaly ?
                            '<div class="px-2 py-1 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-full font-bold">ANOMALIE</div>' :
                            '<div class="px-2 py-1 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-full font-bold">NORMAL</div>'
                        }
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                container.innerHTML = html;
            }

            setupEventListeners() {
                const refreshBtn = document.getElementById('refresh-btn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', async () => {
                        const icon = refreshBtn.querySelector('i');
                        const originalClass = icon.className;
                        icon.className = 'fas fa-spinner fa-spin mr-3';
                        refreshBtn.disabled = true;

                        await Promise.all([
                            this.loadDashboardData(),
                            this.loadDatabaseStats()
                        ]);

                        setTimeout(() => {
                            icon.className = originalClass;
                            refreshBtn.disabled = false;
                        }, 1000);
                    });
                }
            }

            setupFilterEventListeners() {
                // Toggle filtres avanc√©s
                const toggleBtn = document.getElementById('toggleAdvancedFilters');
                const filterPanel = document.getElementById('advancedFiltersPanel');
                const filterArrow = document.getElementById('filterArrow');

                if (toggleBtn && filterPanel) {
                    toggleBtn.addEventListener('click', () => {
                        const isHidden = filterPanel.classList.contains('hidden');
                        if (isHidden) {
                            filterPanel.classList.remove('hidden');
                            filterPanel.classList.add('slide-down');
                            filterArrow.style.transform = 'rotate(180deg)';
                        } else {
                            filterPanel.classList.add('slide-up');
                            filterArrow.style.transform = 'rotate(0deg)';
                            setTimeout(() => {
                                filterPanel.classList.add('hidden');
                                filterPanel.classList.remove('slide-down', 'slide-up');
                            }, 300);
                        }
                    });
                }

                // Appliquer filtres
                const applyBtn = document.getElementById('applyFilters');
                if (applyBtn) {
                    applyBtn.addEventListener('click', () => this.applyFilters());
                }

                // R√©initialiser filtres
                const resetBtn = document.getElementById('resetFilters');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetFilters());
                }
            }

            async applyFilters() {
                // Impl√©mentation simplifi√©e pour le moment
                alert('Filtres appliqu√©s (fonctionnalit√© en d√©veloppement)');
            }

            resetFilters() {
                alert('Filtres r√©initialis√©s');
            }

            async exportData(dataType) {
                try {
                    const response = await fetch(`/weak-indicators/api/export/${dataType}`);
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `export_${dataType}_${new Date().toISOString().slice(0, 10)}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }
                } catch (error) {
                    console.error('Erreur export:', error);
                    alert('Erreur lors de l\'export');
                }
            }
        }

        class AlertSystem {
            constructor() {
                console.log('üîî Syst√®me d\'alertes initialis√©');
            }

            init() {
                console.log('Syst√®me d\'alertes pr√™t');
            }

            loadTemplate(id, name, category, severity, condition, message) {
                document.getElementById('alert-name').value = name;
                document.getElementById('alert-category').value = category;
                document.getElementById('alert-condition').value = condition;
                document.getElementById('alert-message').value = message;

                document.querySelectorAll('input[name="severity"]').forEach(radio => {
                    radio.checked = radio.value === severity;
                });
            }

            testCondition() {
                const condition = document.getElementById('alert-condition').value;
                if (!condition) {
                    alert('Entrez une condition');
                    return;
                }

                alert(`Condition test√©e: ${condition}\n\n(Fonctionnalit√© en d√©veloppement)`);
            }

            exportAlertHistory() {
                alert('Export en d√©veloppement');
            }
        }

        // ============================================================================
        // INITIALISATION AU CHARGEMENT DE LA PAGE
        // ============================================================================

        document.addEventListener('DOMContentLoaded', function () {
            // Initialiser le dashboard
            window.dashboard = new WeakIndicatorsDashboard();
            window.dashboard.init();

            // Initialiser le syst√®me d'alertes
            window.alertSystem = new AlertSystem();
            window.alertSystem.init();

            // Configuration Chart.js
            if (typeof Chart !== 'undefined') {
                Chart.defaults.font.family = "'Segoe UI', 'Inter', system-ui, sans-serif";
                Chart.defaults.color = '#374151';
                Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(15, 23, 42, 0.95)';
                Chart.defaults.plugins.tooltip.titleColor = '#f59e0b';
                Chart.defaults.plugins.tooltip.bodyColor = '#e2e8f0';
                Chart.defaults.plugins.tooltip.borderColor = '#475569';
                Chart.defaults.plugins.tooltip.borderWidth = 1;
            }

            console.log('üéØ Indicateurs Faibles - Mission Control Initialis√©');
        });
    </script>
</body>
</html>
